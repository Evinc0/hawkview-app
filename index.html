<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0F172A">
    <title>HAWKVIEW</title>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0F172A;
            color: #F1F5F9;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #app {
            height: 100vh;
            width: 100vw;
            position: relative;
        }

        .hidden {
            display: none !important;
        }

        /* Main App Layout */
        .main-app {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 80px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(59, 130, 246, 0.2);
            z-index: 1000;
        }

        .nav-item {
            background: none;
            border: none;
            color: #94A3B8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            font-weight: 500;
        }

        .nav-item.active {
            color: #3B82F6;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            padding: 20px;
            padding-bottom: 100px;
            height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        /* Search Container */
        .search-container {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .search-input {
            flex: 1;
            padding: 16px 20px;
            border-radius: 16px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            background: rgba(30, 41, 59, 0.7);
            color: #F1F5F9;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .search-button {
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            background: #3B82F6;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-button:hover {
            background: #2563EB;
            transform: translateY(-2px);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: #3B82F6;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #2563EB;
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.8s ease-out;
        }

        .splash-screen.fade-out {
            opacity: 0;
        }

        .logo-container {
            text-align: center;
            animation: fadeInUp 1s ease-out;
        }

        .logo-placeholder {
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        .logo-placeholder svg {
            filter: drop-shadow(0 10px 20px rgba(59, 130, 246, 0.3));
        }

        .app-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 36px;
            font-weight: 700;
            color: #F1F5F9;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(59, 130, 246, 0.3);
        }

        .app-subtitle {
            font-family: 'Inter', sans-serif;
            font-size: 18px;
            font-weight: 400;
            color: #94A3B8;
            letter-spacing: 0.5px;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Auth Screen */
        .auth-container {
            max-width: 400px;
            margin: 40px auto;
            padding: 30px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .auth-title {
            text-align: center;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: #F1F5F9;
            margin-bottom: 30px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .auth-input {
            padding: 16px 20px;
            border-radius: 16px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            background: rgba(15, 23, 42, 0.5);
            color: #F1F5F9;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: all 0.3s ease;
        }

        .auth-input:focus {
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .auth-button {
            padding: 16px;
            border-radius: 16px;
            border: none;
            background: #3B82F6;
            color: white;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-button:hover {
            background: #2563EB;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
        }

        .guest-button {
            background: transparent;
            border: 2px solid rgba(59, 130, 246, 0.3);
            color: #94A3B8;
        }

        .guest-button:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3B82F6;
        }

        .auth-links {
            text-align: center;
            margin-top: 20px;
        }

        .auth-link {
            color: #3B82F6;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .auth-link:hover {
            color: #2563EB;
            text-decoration: underline;
        }

        /* Camera Scanner Styles */
        .scanner-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .camera-preview {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #000;
        }

        #camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror effect for selfie view */
        }

        #overlay-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .scan-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .scan-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 280px;
            height: 280px;
            border: 3px solid rgba(59, 130, 246, 0.7);
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }

        .scan-instruction {
            position: absolute;
            top: calc(50% + 160px);
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            animation: pulse-text 2s infinite;
        }

        .scanner-controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 20px;
            background: rgba(15, 23, 42, 0.9);
            border-top: 1px solid rgba(59, 130, 246, 0.2);
        }

        .capture-button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid rgba(59, 130, 246, 0.5);
            background: rgba(15, 23, 42, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .capture-inner {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #3B82F6;
            transition: all 0.2s ease;
        }

        .capture-button:active {
            transform: scale(0.95);
            border-color: #3B82F6;
        }

        .capture-button:active .capture-inner {
            background: #2563EB;
            transform: scale(0.9);
        }

        .control-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(148, 163, 184, 0.3);
            background: rgba(30, 41, 59, 0.7);
            color: #94A3B8;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            background: rgba(59, 130, 246, 0.2);
            color: #3B82F6;
            border-color: rgba(59, 130, 246, 0.5);
        }

        .scanner-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background: rgba(30, 41, 59, 0.7);
            border-top: 1px solid rgba(59, 130, 246, 0.1);
            font-size: 14px;
            color: #94A3B8;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #94A3B8;
        }

        .status-indicator.success {
            background: #10B981;
            box-shadow: 0 0 10px #10B981;
        }

        .status-indicator.error {
            background: #EF4444;
            box-shadow: 0 0 10px #EF4444;
        }

        .status-indicator.scanning {
            background: #F59E0B;
            box-shadow: 0 0 10px #F59E0B;
            animation: pulse 1.5s infinite;
        }

        .status-indicator.processing {
            background: #3B82F6;
            box-shadow: 0 0 10px #3B82F6;
            animation: pulse 1s infinite;
        }

        .status-indicator.warning {
            background: #F59E0B;
            box-shadow: 0 0 10px #F59E0B;
        }

        /* Results Overlay */
        .results-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .results-card {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .results-card h3 {
            text-align: center;
            color: #3B82F6;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .product-info h2 {
            color: #F1F5F9;
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .product-info p {
            color: #94A3B8;
            margin: 8px 0;
            font-size: 16px;
        }

        .results-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .results-actions .auth-button {
            flex: 1;
        }

        /* Deals Overlay */
        .deals-overlay {
            height: 100%;
            overflow-y: auto;
            padding: 20px;
        }

        .deals-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .deals-header h2 {
            color: #F1F5F9;
            font-size: 22px;
        }

        .close-deals {
            background: none;
            border: none;
            color: #94A3B8;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-deals:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #EF4444;
        }

        .deal-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .deal-store {
            color: #3B82F6;
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .deal-price {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .current-price {
            color: #10B981;
            font-size: 20px;
            font-weight: 700;
        }

        .original-price {
            color: #94A3B8;
            text-decoration: line-through;
            font-size: 16px;
        }

        .deal-discount {
            color: #10B981;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .deal-coupon {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(59, 130, 246, 0.1);
            padding: 10px 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .deal-coupon span {
            color: #94A3B8;
            font-size: 14px;
        }

        .copy-coupon {
            background: none;
            border: none;
            color: #3B82F6;
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .copy-coupon:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .buy-button {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
        }

        /* Camera Error */
        .camera-error {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .error-content {
            text-align: center;
            padding: 30px;
            background: rgba(30, 41, 59, 0.9);
            border-radius: 20px;
            max-width: 350px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .error-content h3 {
            color: #EF4444;
            margin-bottom: 15px;
        }

        .error-content p {
            color: #94A3B8;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        /* Animations */
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        @keyframes pulse-text {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <!-- App Container -->
    <div id="app">
        <!-- Splash Screen -->
        <div id="splash-screen" class="splash-screen">
            <div class="logo-container">
                <div class="logo-placeholder">
                    <!-- SVG Logo -->
                    <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
                        <circle cx="60" cy="60" r="50" stroke="#3B82F6" stroke-width="4" fill="none"/>
                        <path d="M40 60 L55 75 L80 45" stroke="#3B82F6" stroke-width="6" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h1 class="app-title">HAWKVIEW</h1>
                <p class="app-subtitle">See. Scan. Save.</p>
            </div>
        </div>

        <!-- Main App Content -->
        <div id="main-app" class="main-app hidden">
            <!-- Navigation -->
            <nav class="bottom-nav">
                <button class="nav-item active" data-tab="scan">
                    <span class="nav-icon">🔍</span>
                    <span class="nav-label">Scan</span>
                </button>
                <button class="nav-item" data-tab="search">
                    <span class="nav-icon">🛒</span>
                    <span class="nav-label">Search</span>
                </button>
                <button class="nav-item" data-tab="profile">
                    <span class="nav-icon">👤</span>
                    <span class="nav-label">Profile</span>
                </button>
                <button class="nav-item" data-tab="admin">
                    <span class="nav-icon">⚙️</span>
                    <span class="nav-label">Admin</span>
                </button>
            </nav>

            <!-- Content Areas -->
            <div id="scan-content" class="tab-content active">
                <!-- Camera Scanner Component -->
                <div id="camera-scanner"></div>
            </div>

            <div id="search-content" class="tab-content">
                <!-- Search Component -->
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Search for products...">
                    <button class="search-button">🔍</button>
                </div>
            </div>

            <div id="profile-content" class="tab-content">
                <!-- Profile Component -->
                <div id="profile-area"></div>
            </div>

            <div id="admin-content" class="tab-content">
                <!-- Admin Component -->
                <div id="admin-area"></div>
            </div>
        </div>
    </div>

    <script>
        // Core App Initialization
        function initializeApp() {
            console.log('🚀 HAWKVIEW App Initializing...');
            
            // Initialize components
            initializeComponents();
            
            // Initialize router
            initializeRouter();
            
            // Show splash screen
            showSplashScreen();
            
            // Setup event listeners
            setupEventListeners();
        }

        function initializeComponents() {
            // Initialize all components here
            console.log('📦 Components Initialized');
        }

        function initializeRouter() {
            // Simple tab-based routing
            const navItems = document.querySelectorAll('.nav-item');
            const tabContents = document.querySelectorAll('.tab-content');
            
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const tabName = item.dataset.tab;
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Show corresponding tab content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabName}-content`) {
                            content.classList.add('active');
                        }
                    });
                    
                    // Initialize camera when scan tab is activated
                    if (tabName === 'scan') {
                        initializeCamera();
                    }
                });
            });
        }

        function showSplashScreen() {
            const splashScreen = document.getElementById('splash-screen');
            const mainApp = document.getElementById('main-app');
            
            // Show splash for 3 seconds
            setTimeout(() => {
                splashScreen.classList.add('fade-out');
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    mainApp.classList.remove('hidden');
                    showAuthScreen();
                }, 800);
            }, 3000);
        }

        function showAuthScreen() {
            // This will be implemented in AuthScreen component
            console.log('🔐 Showing Auth Screen');
        }

        function setupEventListeners() {
            // Pull to refresh
            let startY = 0;
            let currentY = 0;
            
            document.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
            });
            
            document.addEventListener('touchmove', (e) => {
                currentY = e.touches[0].clientY;
                const diff = currentY - startY;
                
                if (diff > 50 && window.scrollY === 0) {
                    // Refresh action
                    location.reload();
                }
            });
            
            console.log('👂 Event Listeners Setup');
        }

        // Utility functions
        function getUserType() {
            // Check if user is logged in or guest
            const userData = localStorage.getItem('hawkview_user');
            if (!userData) return 'guest';
            
            const user = JSON.parse(userData);
            return user.type || 'guest';
        }

        function saveUser(userData) {
            localStorage.setItem('hawkview_user', JSON.stringify(userData));
        }

        function clearUser() {
            localStorage.removeItem('hawkview_user');
        }

        // Camera Scanner Class
        class CameraScanner {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.video = null;
                this.canvas = null;
                this.stream = null;
                this.isScanning = false;
                this.aiModel = null;
                this.init();
            }
            
            async init() {
                this.render();
                await this.setupCamera();
                this.setupEventListeners();
                console.log('📸 Camera Scanner Initialized');
            }
            
            render() {
                this.container.innerHTML = `
                    <div class="scanner-container">
                        <div class="camera-preview">
                            <video id="camera-feed" autoplay playsinline></video>
                            <canvas id="overlay-canvas"></canvas>
                            <div class="scan-overlay">
                                <div class="scan-frame"></div>
                                <div class="scan-instruction">Point camera at product</div>
                            </div>
                        </div>
                        
                        <div class="scanner-controls">
                            <button id="capture-btn" class="capture-button">
                                <div class="capture-inner"></div>
                            </button>
                            <button id="toggle-flash" class="control-button flash-button">⚡</button>
                            <button id="switch-camera" class="control-button switch-button">🔄</button>
                        </div>
                        
                        <div class="scanner-status" id="scanner-status">
                            <div class="status-indicator"></div>
                            <span>Ready to scan</span>
                        </div>
                    </div>
                `;
                
                this.video = document.getElementById('camera-feed');
                this.canvas = document.getElementById('overlay-canvas');
            }
            
            async setupCamera() {
                try {
                    const constraints = {
                        video: {
                            facingMode: 'environment', // Prefer back camera
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        },
                        audio: false
                    };
                    
                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    this.video.srcObject = this.stream;
                    
                    // Setup canvas for drawing
                    this.video.addEventListener('loadedmetadata', () => {
                        this.canvas.width = this.video.videoWidth;
                        this.canvas.height = this.video.videoHeight;
                    });
                    
                    this.updateStatus('Camera ready', 'success');
                    
                } catch (error) {
                    console.error('Camera error:', error);
                    this.updateStatus('Camera access denied', 'error');
                    this.showCameraError();
                }
            }
            
            setupEventListeners() {
                const captureBtn = document.getElementById('capture-btn');
                const flashBtn = document.getElementById('toggle-flash');
                const switchBtn = document.getElementById('switch-camera');
                
                captureBtn.addEventListener('click', () => this.captureFrame());
                flashBtn.addEventListener('click', () => this.toggleFlash());
                switchBtn.addEventListener('click', () => this.switchCamera());
                
                // Auto-start scanning when video is ready
                this.video.addEventListener('play', () => {
                    this.startScanning();
                });
            }
            
            startScanning() {
                if (this.isScanning) return;
                
                this.isScanning = true;
                this.updateStatus('Scanning for products...', 'scanning');
                this.scanLoop();
            }
            
            stopScanning() {
                this.isScanning = false;
            }
            
            async scanLoop() {
                if (!this.isScanning) return;
                
                // In future: run AI detection here
                // For now: simulate detection
                await this.simulateDetection();
                
                requestAnimationFrame(() => this.scanLoop());
            }
            
            async simulateDetection() {
                // Simulate AI processing delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Random detection for demo
                if (Math.random() > 0.95) {
                    this.onProductDetected({
                        name: "Sample Product",
                        confidence: Math.floor(Math.random() * 40 + 60), // 60-99%
                        boundingBox: {
                            x: Math.random() * 0.6 + 0.2,
                            y: Math.random() * 0.6 + 0.2,
                            width: 0.3,
                            height: 0.4
                        }
                    });
                }
            }
            
            onProductDetected(product) {
                console.log('🎯 Product Detected:', product);
                this.drawBoundingBox(product.boundingBox);
                this.updateStatus(`Found: ${product.name} (${product.confidence}%)`, 'success');
                
                // In future: trigger search and coupon finding
                setTimeout(() => {
                    this.showResults(product);
                }, 1000);
            }
            
            drawBoundingBox(box) {
                const ctx = this.canvas.getContext('2d');
                ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                const x = box.x * this.canvas.width;
                const y = box.y * this.canvas.height;
                const width = box.width * this.canvas.width;
                const height = box.height * this.canvas.height;
                
                // Draw detection box
                ctx.strokeStyle = '#3B82F6';
                ctx.lineWidth = 3;
                ctx.strokeRect(x, y, width, height);
                
                // Draw corner markers
                ctx.fillStyle = '#3B82F6';
                const markerSize = 15;
                
                // Top-left
                ctx.fillRect(x, y, markerSize, 3);
                ctx.fillRect(x, y, 3, markerSize);
                
                // Top-right
                ctx.fillRect(x + width - markerSize, y, markerSize, 3);
                ctx.fillRect(x + width - 3, y, 3, markerSize);
                
                // Bottom-left
                ctx.fillRect(x, y + height - 3, markerSize, 3);
                ctx.fillRect(x, y + height - markerSize, 3, markerSize);
                
                // Bottom-right
                ctx.fillRect(x + width - markerSize, y + height - 3, markerSize, 3);
                ctx.fillRect(x + width - 3, y + height - markerSize, 3, markerSize);
            }
            
            captureFrame() {
                this.updateStatus('Processing image...', 'processing');
                
                // Create canvas for full frame capture
                const captureCanvas = document.createElement('canvas');
                captureCanvas.width = this.video.videoWidth;
                captureCanvas.height = this.video.videoHeight;
                
                const ctx = captureCanvas.getContext('2d');
                ctx.drawImage(this.video, 0, 0);
                
                // Convert to blob for processing
                captureCanvas.toBlob((blob) => {
                    this.processImage(blob);
                }, 'image/jpeg', 0.8);
            }
            
            async processImage(blob) {
                // Simulate AI processing
                this.updateStatus('Analyzing product...', 'processing');
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Mock result
                const mockResult = {
                    name: "iPhone 15 Pro",
                    brand: "Apple",
                    category: "Electronics",
                    confidence: 92,
                    priceRange: "$999-$1,199"
                };
                
                this.showResults(mockResult);
            }
            
            showResults(result) {
                this.stopScanning();
                this.updateStatus('Analysis complete', 'success');
                
                // Show results overlay
                const resultsOverlay = document.createElement('div');
                resultsOverlay.className = 'results-overlay';
                resultsOverlay.innerHTML = `
                    <div class="results-card">
                        <h3>🔍 Product Identified</h3>
                        <div class="product-info">
                            <h2>${result.name}</h2>
                            <p>Brand: ${result.brand || 'Unknown'}</p>
                            <p>Category: ${result.category || 'General'}</p>
                            <p>Confidence: ${result.confidence}%</p>
                            <p>Price Range: ${result.priceRange || 'Checking stores...'}</p>
                        </div>
                        <div class="results-actions">
                            <button class="auth-button" id="find-deals">Find Best Deals</button>
                            <button class="auth-button guest-button" id="scan-again">Scan Again</button>
                        </div>
                    </div>
                `;
                
                this.container.appendChild(resultsOverlay);
                
                // Setup result actions
                document.getElementById('find-deals').addEventListener('click', () => {
                    this.findDeals(result);
                });
                
                document.getElementById('scan-again').addEventListener('click', () => {
                    resultsOverlay.remove();
                    this.startScanning();
                });
            }
            
            async findDeals(product) {
                this.updateStatus('Searching for best deals...', 'processing');
                
                // Simulate deal finding
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Mock deals data
                const deals = [
                    {
                        store: "Amazon",
                        price: "$1,099.99",
                        originalPrice: "$1,199.99",
                        discount: "$100",
                        coupon: "APPLE15",
                        url: "#",
                        rating: 4.5
                    },
                    {
                        store: "Best Buy",
                        price: "$1,049.99",
                        originalPrice: "$1,199.99",
                        discount: "$150",
                        coupon: "TECH20",
                        url: "#",
                        rating: 4.2
                    }
                ];
                
                this.showDeals(deals);
            }
            
            showDeals(deals) {
                this.updateStatus('Best deals found!', 'success');
                
                // Replace results with deals
                const dealsOverlay = document.createElement('div');
                dealsOverlay.className = 'deals-overlay';
                dealsOverlay.innerHTML = `
                    <div class="deals-header">
                        <h2>💰 Best Deals Found</h2>
                        <button class="close-deals">×</button>
                    </div>
                    <div class="deals-list">
                        ${deals.map((deal, index) => `
                            <div class="deal-card">
                                <div class="deal-store">${deal.store}</div>
                                <div class="deal-price">
                                    <span class="current-price">${deal.price}</span>
                                    <span class="original-price">${deal.originalPrice}</span>
                                </div>
                                <div class="deal-discount">Save ${deal.discount}</div>
                                <div class="deal-coupon">
                                    <span>Coupon: ${deal.coupon}</span>
                                    <button class="copy-coupon" data-coupon="${deal.coupon}">📋</button>
                                </div>
                                <div class="deal-actions">
                                    <button class="auth-button buy-button" data-url="${deal.url}">
                                        Buy Now
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <button class="auth-button guest-button" id="back-to-scanner">Back to Scanner</button>
                `;
                
                // Replace existing content
                this.container.innerHTML = '';
                this.container.appendChild(dealsOverlay);
                
                // Setup deal actions
                document.querySelectorAll('.copy-coupon').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const coupon = btn.dataset.coupon;
                        this.copyToClipboard(coupon);
                        btn.textContent = '✓';
                        setTimeout(() => {
                            btn.textContent = '📋';
                        }, 2000);
                    });
                });
                
                document.getElementById('back-to-scanner').addEventListener('click', () => {
                    this.container.innerHTML = '';
                    this.render();
                    this.setupCamera();
                });
            }
            
            copyToClipboard(text) {
                navigator.clipboard.writeText(text).catch(err => {
                    console.error('Failed to copy:', err);
                });
            }
            
            toggleFlash() {
                // Future implementation for flash control
                this.updateStatus('Flash not available', 'warning');
            }
            
            async switchCamera() {
                // Stop current stream
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                }
                
                try {
                    // Try to switch to user-facing camera
                    const constraints = {
                        video: {
                            facingMode: 'user',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        }
                    };
                    
                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    this.video.srcObject = this.stream;
                    this.updateStatus('Switched to front camera', 'success');
                    
                } catch (error) {
                    console.error('Camera switch error:', error);
                    this.updateStatus('Cannot switch camera', 'error');
                }
            }
            
            updateStatus(message, type = 'info') {
                const statusEl = document.getElementById('scanner-status');
                if (!statusEl) return;
                
                statusEl.innerHTML = `
                    <div class="status-indicator ${type}"></div>
                    <span>${message}</span>
                `;
                
                // Add animation
                statusEl.style.animation = 'none';
                setTimeout(() => {
                    statusEl.style.animation = 'pulse 0.5s';
                }, 10);
            }
            
            showCameraError() {
                const errorOverlay = document.createElement('div');
                errorOverlay.className = 'camera-error';
                errorOverlay.innerHTML = `
                    <div class="error-content">
                        <h3>📷 Camera Access Required</h3>
                        <p>Please enable camera permissions to use HAWKVIEW's scanning feature.</p>
                        <button class="auth-button" id="retry-camera">Retry Camera</button>
                    </div>
                `;
                
                this.container.appendChild(errorOverlay);
                
                document.getElementById('retry-camera').addEventListener('click', () => {
                    errorOverlay.remove();
                    this.setupCamera();
                });
            }
            
            destroy() {
                this.stopScanning();
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                }
            }
        }

        // Initialize camera when scan tab is active
        function initializeCamera() {
            const cameraContainer = document.getElementById('camera-scanner');
            if (cameraContainer && !cameraContainer.hasChildNodes()) {
                new CameraScanner('camera-scanner');
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });
    </script>
</body>
</html>